<!DOCTYPE html>
<html>
<head>
  <title>Disease Prediction</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

  <style>
    input[type="text"] { width: 300px; }
    .suggestions div { cursor: pointer; padding: 5px; border-bottom: 1px solid #ccc; }
    .suggestions { max-height: 150px; overflow-y: scroll; border: 1px solid #aaa; width: 300px; }
    #selected { margin-top: 10px; }
    .selected-item { background-color: #e3e3ff; display: inline-block; padding: 5px 10px; margin: 5px; border-radius: 5px; }
  </style>
</head>
<body class="container mt-5">
  <h2 class="mb-4">Select Your Symptoms</h2>
  <form method="POST" action="/predict">
    <input class="form-control" type="text" id="symptomInput" placeholder="Type a symptom...">
    <div class="suggestions" id="suggestionBox"></div>

    <div id="selected" class="mt-3"></div>
    <div id="hiddenInputs"></div>

    <br><input class="btn btn-primary" type="submit" value="Predict">
  </form>

<script>
  const features = {{ features|tojson }};
  const selectedSymptoms = new Set();

  $('#symptomInput').on('input', function () {
    const query = $(this).val().toLowerCase();
    const matches = features.filter(f => f.toLowerCase().startsWith(query));
    const suggestionBox = $('#suggestionBox').empty();

    matches.forEach(match => {
      suggestionBox.append(`<div class="suggestion-item">${match}</div>`);
    });
  });

  $(document).on('click', '.suggestion-item', function () {
    const symptom = $(this).text();
    if (!selectedSymptoms.has(symptom)) {
      selectedSymptoms.add(symptom);

      $('#selected').append(
        `<div class="selected-item" data-symptom="${symptom}">
          ${symptom} <span class="remove" style="color:red; cursor:pointer;">×</span>
        </div>`
      );

      $('#hiddenInputs').append(
        `<input type="hidden" name="symptoms" value="${symptom}" data-symptom="${symptom}">`
      );
    }

    $('#symptomInput').val('');
    $('#suggestionBox').empty();
  });

  // Remove symptom on "×" click
  $(document).on('click', '.remove', function () {
    const parentDiv = $(this).parent();
    const symptom = parentDiv.data('symptom');

    selectedSymptoms.delete(symptom);
    parentDiv.remove();
    $(`#hiddenInputs input[data-symptom="${symptom}"]`).remove();
  });
</script>

</body>
</html>
